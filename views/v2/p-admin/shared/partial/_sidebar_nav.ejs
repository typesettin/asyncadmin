<%
  var auth_link =(locals.use_separate_accounts)?'p-auth':'auth'; 
  var user_account_link =(locals.use_separate_accounts)?'account':'user'; 

 var navmenu={
    "tree": []
  },
  StylieTreeview = locals.stylietreeview;

  var menu_themes = {
    "tree-item": "folder",
    "tree-item-label": "Themes",
    "tree-item-id": "asyncadmin.themes",
    "tree-item-attributes": {
      "class": "async-admin-ajax-link",
      "title": "this is a file link"
    },
    "tree-item-folder-contents": [{
      "tree-item": "file",
      "tree-item-label": "Manage Themes",
      "tree-item-id": "asyncadmin.themes.manage",
      "tree-item-link": "/"+locals.adminPath+"/themes/",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Manage your themes",
        "style":"background-image: url(/images/adminui/svg/gears5.svg);"
      }
    }, {
      "tree-item": "file",
      "tree-item-label": locals.themename+" Settings",
      "tree-item-id": "asyncadmin.themes.setting",
      "tree-item-link": "/"+locals.adminPath+"/themes/settings",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": locals.themename+" Settings",
        "style":"background-image: url(/images/adminui/svg/size9.svg);"
      }
    }]
  };

  if(locals.themeasyncadmin && locals.themeasyncadmin && locals.themeasyncadmin.menu && locals.themeasyncadmin.menu.Themes){
    for (var x in locals.themeasyncadmin.menu.Themes){
      menu_themes["tree-item-folder-contents"].push(locals.themeasyncadmin.menu.Themes[x]);
    }
  }

  if(pagedata.extensions.menu && pagedata.extensions.menu.Themes){
    for (var x in pagedata.extensions.menu.Themes){
      menu_themes["tree-item-folder-contents"].push(pagedata.extensions.menu.Themes[x]);
    }
  }

  if(locals.extasyncadmin && locals.extasyncadmin && locals.extasyncadmin.menu && locals.extasyncadmin.menu.Themes){
    for (var x in locals.extasyncadmin.menu.Themes){
      menu_themes["tree-item-folder-contents"].push(locals.extasyncadmin.menu.Themes[x]);
    }
  }

  var menu_extensions = {
    "tree-item": "folder",
    "tree-item-label": "Extensions",
    "tree-item-id": "asyncadmin.extensions",
    "tree-item-attributes": {
      "class": "async-admin-ajax-link",
      "title": "this is a file link"
    },
    "tree-item-folder-contents": [{
      "tree-item": "file",
      "tree-item-label": "Manage Extensions",
      "tree-item-id": "asyncadmin.extensions.manage",
      "tree-item-link": "/"+locals.adminPath+"/extensions/",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Manage your themes",
        "style":"background-image: url(/images/adminui/svg/puzzle35.svg);"
      }
    }]
  };

  if(locals.themeasyncadmin && locals.themeasyncadmin.menu && locals.themeasyncadmin.menu.Extensions){
    for (var x in locals.themeasyncadmin.menu.Extensions){
      menu_extensions["tree-item-folder-contents"].push(locals.themeasyncadmin.menu.Extensions[x]);
    }
  }

  if(pagedata.extensions.menu && pagedata.extensions.menu.Extensions){
    for (var x in pagedata.extensions.menu.Extensions){
      menu_extensions["tree-item-folder-contents"].push(pagedata.extensions.menu.Extensions[x]);
    }
  }

  if(locals.extasyncadmin && locals.extasyncadmin.menu && locals.extasyncadmin.menu.Extensions){
    for (var x in locals.extasyncadmin.menu.Extensions){
      menu_extensions["tree-item-folder-contents"].push(locals.extasyncadmin.menu.Extensions[x]);
    }
  }

  var menu_settings = {
    "tree-item": "folder",
    "tree-item-label": "Settings",
    "tree-item-id": "asyncadmin.settings",
    "tree-item-attributes": {
      "class": "async-admin-ajax-link",
      "title": "Modify your Periodic configuration",
      "style":"background-image: url(/images/adminui/svg/gear33.svg);"
    },
    "tree-item-folder-contents": [{
      "tree-item": "file",
      "tree-item-label": "Periodic Settings",
      "tree-item-id": "asyncadmin.settings.manage",
      "tree-item-link": "/"+locals.adminPath+"/settings",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Manage your themes"
      }
    },{
      "tree-item": "file",
      "tree-item-label": "Manage Users",
      "tree-item-id": "asyncadmin.settings.manage.users",
      "tree-item-link": "/"+locals.adminPath+"/users",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Manage user settings"
      }
    },{
      "tree-item": "file",
      "tree-item-label": "Manage User Roles",
      "tree-item-id": "asyncadmin.settings.manage.userroles",
      "tree-item-link": "/"+locals.adminPath+"/userroles",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Manage userroles settings"
      }
    },{
      "tree-item": "file",
      "tree-item-label": "Manage User Privileges",
      "tree-item-id": "asyncadmin.settings.manage.userprivileges",
      "tree-item-link": "/"+locals.adminPath+"/userprivileges",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Manage userroles settings"
      }
    },{
      "tree-item": "file",
      "tree-item-label": "Restart Application",
      "tree-item-id": "asyncadmin.settings.manage.restart",
      "tree-item-link": "/"+locals.adminPath+"/settings#restart",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Manage userroles settings"
      }
    },{
      "tree-item": "file",
      "tree-item-label": "Help",
      "tree-item-id": "asyncadmin.settings.manage.help",
      "tree-item-link": "/"+locals.adminPath+"/settings#help",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Manage userroles settings"
      }
    }]
  };

  if(locals.use_separate_accounts){
    menu_settings["tree-item-folder-contents"].splice(1,0,{
      "tree-item": "file",
      "tree-item-label": "Manage Accounts",
      "tree-item-id": "asyncadmin.settings.manage.accounts",
      "tree-item-link": "/"+locals.adminPath+"/accounts",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Manage user settings"
      }
    });
  }

  if(locals.themeasyncadmin && locals.themeasyncadmin.menu && locals.themeasyncadmin.menu.Settings){
    for (var x in locals.themeasyncadmin.menu.Settings){
      menu_settings["tree-item-folder-contents"].push(locals.themeasyncadmin.menu.Settings[x]);
    }
  }

  if(pagedata.extensions.menu && pagedata.extensions.menu.Settings){
    for (var x in pagedata.extensions.menu.Settings){
      menu_settings["tree-item-folder-contents"].push(pagedata.extensions.menu.Settings[x]);
    }
  }

  if(locals.extasyncadmin && locals.extasyncadmin.menu && locals.extasyncadmin.menu.Settings){
    for (var x in locals.extasyncadmin.menu.Settings){
      menu_settings["tree-item-folder-contents"].push(locals.extasyncadmin.menu.Settings[x]);
    }
  }

  var menu_logout = (user)? {
    "tree-item": "file",
    "tree-item-label": "Log Out",
    "tree-item-id": "asyncadmin.logout",
    "tree-item-link": "/"+auth_link+"/logout",
    "tree-item-attributes": {
      "class": "ts-force-link",
      "title": "Log out of your account",
      "style":"background-image: url(/images/adminui/svg/logout20.svg);"
    }
  } : {
    "tree-item": "file",
    "tree-item-label": "Log In",
    "tree-item-id": "asyncadmin.login",
    "tree-item-link": "/"+auth_link+"/login",
    "tree-item-attributes": {
      "class": "ts-force-link",
      "title": "Log in to your account",
      "style":"background-image: url(/images/adminui/svg/user153.svg);"
    }
  };
 
  var menu_dashboard = {
    "tree-item": "file",
    "tree-item-label": "Admin Dashboard",
    "tree-item-id": "asyncadmin.dashboard",
    "tree-item-link": "/%locals.adminPath%/dashboard/",
    "tree-item-attributes": {
      "class": "async-admin-ajax-link",
      "title": "Periodic Admin Dashboard",
      "style":"background-image: url(/images/adminui/svg/speedometer35.svg);"
    }
  };
  navmenu.tree.push(menu_dashboard);
 
  if(user){
    var menu_account_settings = {
      "tree-item": "file",
      "tree-item-label": "Account Settings",
      "tree-item-id": "asyncadmin.accountsettings",
      "tree-item-link": "/%locals.adminPath%/"+user_account_link+"/"+user._id+"/edit",
      "tree-item-attributes": {
        "class": "async-admin-ajax-link",
        "title": "Edit your profile",
        "style":"background-image: url(/images/adminui/svg/user153.svg);"
      }
    };
    navmenu.tree.push(menu_account_settings);
  }

  if(locals.themeasyncadmin && locals.themeasyncadmin.menu && locals.themeasyncadmin.menu.Global){
    for (var x in locals.themeasyncadmin.menu.Global){
      if(typeof locals.themeasyncadmin.menu.Global[x].userprivilege !=='undefined'){
        if(user && (user.privileges[locals.themeasyncadmin.menu.Global[x].userprivilege] || user.accounttype==='admin')){
          navmenu.tree.push(locals.themeasyncadmin.menu.Global[x]);
        }
      }
      else{
        navmenu.tree.push(locals.themeasyncadmin.menu.Global[x]);
      }
    }
  }

  if(pagedata.extensions.menu && pagedata.extensions.menu.Global){
    for (var x in pagedata.extensions.menu.Global){
      if(typeof pagedata.extensions.menu.Global[x].userprivilege !=='undefined'){
        if(user && (user.privileges[pagedata.extensions.menu.Global[x].userprivilege] || user.accounttype==='admin')){
          navmenu.tree.push(pagedata.extensions.menu.Global[x]);
        }
      }
      else{
        navmenu.tree.push(pagedata.extensions.menu.Global[x]);
      }
    }
  }

  if(locals.extasyncadmin && locals.extasyncadmin.menu && locals.extasyncadmin.menu.Global){
    for (var x in locals.extasyncadmin.menu.Global){
      if(typeof locals.extasyncadmin.menu.Global[x].userprivilege !=='undefined'){
        if(user && (user.privileges[locals.extasyncadmin.menu.Global[x].userprivilege] || user.accounttype==='admin')){
          navmenu.tree.push(locals.extasyncadmin.menu.Global[x]);
        }
      }
      else{
        navmenu.tree.push(locals.extasyncadmin.menu.Global[x]);
      }
    }
  }

  if(user){
    if(user.privileges['120'] || user.accounttype==='admin'){
      navmenu.tree.push(menu_themes);
    }
    if(user.privileges['130'] || user.accounttype==='admin'){
      navmenu.tree.push(menu_extensions);
    }
    if(user.privileges['140'] || user.accounttype==='admin'){
      navmenu.tree.push(menu_settings);
    }
  }
  navmenu.tree.push(menu_logout);


  navTreeview = new locals.stylietreeview({
    tree:navmenu
  });

  navTreeViewHTML = navTreeview.getTreeHTML().replace(/%locals.adminPath%/gi,locals.adminPath);

  %>
  <%- navTreeViewHTML %>
<script type="text/javascript">
  <%- locals.viewhelper.passObjToClient(navmenu,"periodic_navmenu") %>
</script>